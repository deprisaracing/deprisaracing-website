<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简易房间分配系统</title>
    <style>
        /* 样式部分与之前相同，已省略以节省空间 */
        /* 完整样式请参考之前的代码 */
    </style>
</head>
<body>
    <div class="container">
        <h1>简易房间分配系统</h1>
        <p class="subtitle">7位参与者将随机分配到3个房间：A房(2人)、B房(2人)、C房(3人)</p>
        
        <div class="instructions">
            <h3>重要提示：此版本适合小范围临时使用</h3>
            <ol>
                <li>所有参与者需要<b>在同一时间段内</b>完成分配</li>
                <li>数据不会永久保存，刷新页面可能会丢失部分数据</li>
                <li>适合一次性活动使用</li>
                <li>如需长期使用，请使用Firebase版本</li>
            </ol>
        </div>
        
        <!-- 其余HTML结构与之前相同，已省略 -->
    </div>

    <script>
        // 使用简易的共享存储（基于sessionStorage和轮询刷新）
        // 注意：这只是一个临时的解决方案
        
        document.addEventListener('DOMContentLoaded', function() {
            const assignButton = document.getElementById('assignButton');
            const resultTableBody = document.getElementById('resultTableBody');
            const statusMessage = document.getElementById('statusMessage');
            const userNameInput = document.getElementById('userName');
            const roomACount = document.getElementById('roomA-count');
            const roomBCount = document.getElementById('roomB-count');
            const roomCCount = document.getElementById('roomC-count');
            
            // 存储键名，可以修改以创建新的分配
            const STORAGE_KEY = 'room_assignments_v1';
            
            // 房间容量配置
            const roomConfig = {
                'A': { max: 2, current: 0, members: [] },
                'B': { max: 2, current: 0, members: [] },
                'C': { max: 3, current: 0, members: [] }
            };
            
            // 从存储加载分配结果
            function loadAssignments() {
                try {
                    const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                    return data;
                } catch (e) {
                    return {};
                }
            }
            
            // 保存分配结果
            function saveAssignments(assignments) {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(assignments));
                // 触发存储事件，让其他标签页也能更新
                window.dispatchEvent(new Event('storage'));
            }
            
            // 更新显示
            function updateDisplay() {
                const assignments = loadAssignments();
                
                // 重置计数
                for (let room in roomConfig) {
                    roomConfig[room].current = 0;
                    roomConfig[room].members = [];
                }
                
                // 计算房间人数
                for (let userName in assignments) {
                    const room = assignments[userName];
                    if (roomConfig[room]) {
                        roomConfig[room].current++;
                        roomConfig[room].members.push(userName);
                    }
                }
                
                // 更新计数显示
                roomACount.textContent = roomConfig['A'].current;
                roomBCount.textContent = roomConfig['B'].current;
                roomCCount.textContent = roomConfig['C'].current;
                
                // 显示结果
                displayResults(assignments);
                
                // 更新状态
                const currentUser = userNameInput.value.trim();
                if (currentUser && assignments[currentUser]) {
                    updateStatusMessage(`您已经分配过房间了！您被分配在房间 ${assignments[currentUser]}`, "error");
                    assignButton.disabled = true;
                } else if (isAllRoomsFull()) {
                    updateStatusMessage("所有房间已满，分配完成！", "success");
                    assignButton.disabled = true;
                }
            }
            
            // 检查是否所有房间已满
            function isAllRoomsFull() {
                return roomConfig['A'].current >= roomConfig['A'].max &&
                       roomConfig['B'].current >= roomConfig['B'].max &&
                       roomConfig['C'].current >= roomConfig['C'].max;
            }
            
            // 随机分配房间
            function assignRoom() {
                const userName = userNameInput.value.trim();
                
                if (!userName) {
                    updateStatusMessage("请输入您的姓名！", "error");
                    return;
                }
                
                const assignments = loadAssignments();
                
                // 检查是否已分配
                if (assignments[userName]) {
                    updateStatusMessage(`您已经分配过房间了！您被分配在房间 ${assignments[userName]}`, "error");
                    return;
                }
                
                // 检查是否所有房间已满
                if (isAllRoomsFull()) {
                    updateStatusMessage("所有房间已满，无法再分配！", "error");
                    return;
                }
                
                // 找出还有空间的房间
                const availableRooms = Object.keys(roomConfig).filter(
                    room => roomConfig[room].current < roomConfig[room].max
                );
                
                // 随机选择一个可用房间
                const randomRoom = availableRooms[Math.floor(Math.random() * availableRooms.length)];
                
                // 分配用户到房间
                assignments[userName] = randomRoom;
                
                // 保存结果
                saveAssignments(assignments);
                
                // 更新显示
                updateDisplay();
                
                // 更新状态消息
                if (isAllRoomsFull()) {
                    updateStatusMessage(`恭喜！您被分配到房间 ${randomRoom}。所有房间已满，分配完成！`, "success");
                } else {
                    updateStatusMessage(`恭喜！您被分配到房间 ${randomRoom}。`, "success");
                }
                
                assignButton.disabled = true;
            }
            
            // 显示结果
            function displayResults(assignments) {
                // 代码与之前相同，已省略
            }
            
            // 初始化
            updateDisplay();
            
            // 监听其他标签页的存储变化
            window.addEventListener('storage', updateDisplay);
            
            // 定期检查更新（每2秒）
            setInterval(updateDisplay, 2000);
            
            // 事件监听
            assignButton.addEventListener('click', assignRoom);
            
            // 输入框事件
            userNameInput.addEventListener('input', function() {
                const userName = userNameInput.value.trim();
                const assignments = loadAssignments();
                
                if (!userName) {
                    updateStatusMessage("请输入您的姓名，然后点击'随机分配房间'按钮", "warning");
                    assignButton.disabled = false;
                    return;
                }
                
                if (assignments[userName]) {
                    updateStatusMessage(`您已经分配过房间了！您被分配在房间 ${assignments[userName]}`, "error");
                    assignButton.disabled = true;
                } else if (isAllRoomsFull()) {
                    updateStatusMessage("所有房间已满，无法再分配！", "error");
                    assignButton.disabled = true;
                } else {
                    updateStatusMessage("点击'随机分配房间'按钮进行分配", "success");
                    assignButton.disabled = false;
                }
            });
        });
    </script>
</body>
</html>



